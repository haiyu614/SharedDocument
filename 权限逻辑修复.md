# ç¼–è¾‘å™¨æƒé™é€»è¾‘ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶ï¼š**
- å›¾æ ‡å·²ç»ä»"çœ¼ç›"å˜æˆ"ç¼–è¾‘"äº† âœ…
- ä½†ç‚¹å‡»è¿›å…¥ç¼–è¾‘å™¨åï¼Œè¢«é‡å®šå‘å›é¦–é¡µ
- Flash æç¤ºï¼š"æ‚¨æ²¡æœ‰æƒé™ç¼–è¾‘æ­¤æ–‡ä»¶"
- æ—¥å¿—æ˜¾ç¤ºï¼š`GET /documents/editor/20 HTTP/1.1" 302`

## ğŸ” é—®é¢˜æ ¹æº

### é”™è¯¯çš„ä»£ç é€»è¾‘ï¼ˆç¬¬ 161-170 è¡Œï¼‰

```python
if not is_owner:
    share = DocumentShare.query.filter_by(...).first()
    if share:
        if share.permission == 'edit':
            can_edit = True  # âœ… è®¾ç½®äº† can_edit
            # âŒ ä½†å¿˜è®°è®¾ç½® can_view = True
        else:
            can_view = True  # âœ… view æƒé™è®¾ç½®äº† can_view
```

### é—®é¢˜åˆ†æ

**åˆå§‹çŠ¶æ€ï¼š**
```python
can_edit = is_owner  # Falseï¼ˆä¸æ˜¯æ‰€æœ‰è€…ï¼‰
can_view = is_owner  # Falseï¼ˆä¸æ˜¯æ‰€æœ‰è€…ï¼‰
```

**å½“æƒé™æ˜¯ `edit` æ—¶ï¼š**
```python
can_edit = True   # âœ… æ­£ç¡®
can_view = False  # âŒ å¿˜è®°è®¾ç½®ï¼
```

**æ£€æŸ¥æƒé™ï¼š**
```python
if not can_view:  # False ä¸æ»¡è¶³ï¼Œæ‰€ä»¥è¢«æ‹¦æˆªï¼
    flash('æ‚¨æ²¡æœ‰æƒé™ç¼–è¾‘æ­¤æ–‡ä»¶')
    return redirect(url_for('auth.index'))
```

**ç»“æœï¼š** å³ä½¿æœ‰ `edit` æƒé™ï¼Œå› ä¸º `can_view = False`ï¼Œæ‰€ä»¥è¢«é‡å®šå‘äº†ï¼

## âœ… ä¿®å¤åçš„é€»è¾‘

```python
if not is_owner:
    share = DocumentShare.query.filter_by(...).first()
    if share:
        can_view = True  # âœ… åªè¦æœ‰åˆ†äº«è®°å½•å°±èƒ½æŸ¥çœ‹
        if share.permission == 'edit':
            can_edit = True  # âœ… edit æƒé™é¢å¤–å¯ä»¥ç¼–è¾‘
```

### ä¿®å¤åçš„çŠ¶æ€

**å½“æƒé™æ˜¯ `edit` æ—¶ï¼š**
```python
can_view = True  # âœ… å¯ä»¥æŸ¥çœ‹
can_edit = True  # âœ… å¯ä»¥ç¼–è¾‘
```

**å½“æƒé™æ˜¯ `view` æ—¶ï¼š**
```python
can_view = True  # âœ… å¯ä»¥æŸ¥çœ‹
can_edit = False # âœ… ä¸èƒ½ç¼–è¾‘ï¼ˆä¿æŒåˆå§‹å€¼ï¼‰
```

## ğŸ¯ æƒé™çŸ©é˜µ

| è§’è‰² | can_view | can_edit | ç»“æœ |
|------|----------|----------|------|
| æ‰€æœ‰è€… | True | True | å®Œå…¨æ§åˆ¶ |
| edit æƒé™ | True | True | å¯ç¼–è¾‘ âœ… |
| view æƒé™ | True | False | åªè¯» âœ… |
| æ— æƒé™ | False | False | è¢«æ‹¦æˆª âœ… |

## ğŸ”„ å®Œæ•´çš„æƒé™æ£€æŸ¥æµç¨‹

```
ç”¨æˆ·è®¿é—®ç¼–è¾‘å™¨
    â†“
åˆå§‹åŒ–ï¼šcan_view = False, can_edit = False
    â†“
æ˜¯å¦ä¸ºæ‰€æœ‰è€…ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ can_view = True, can_edit = True
    â””â”€ å¦ â†’ æŸ¥è¯¢ DocumentShare
            â”œâ”€ æœ‰è®°å½• â†’ can_view = True
            â”‚           â”œâ”€ permission == 'edit' â†’ can_edit = True
            â”‚           â””â”€ permission == 'view' â†’ can_edit = False
            â””â”€ æ— è®°å½• â†’ can_view = False, can_edit = False
    â†“
æ£€æŸ¥ can_view
    â”œâ”€ False â†’ é‡å®šå‘é¦–é¡µï¼ˆæ— æƒé™ï¼‰
    â””â”€ True â†’ ç»§ç»­
    â†“
æ£€æŸ¥æ–‡ä»¶ç±»å‹æ˜¯å¦å¯ç¼–è¾‘
    â†“
æ¸²æŸ“ç¼–è¾‘å™¨ï¼ˆä¼ é€’ can_editï¼‰
    â†“
å‰ç«¯æ ¹æ® can_edit æ˜¾ç¤ºç•Œé¢
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼šedit æƒé™
```
ç”¨æˆ·Aåˆ†äº«æ–‡æ¡£ç»™ç”¨æˆ·Bï¼Œæƒé™ï¼šedit
    â†“
ç”¨æˆ·Bè®¿é—®ç¼–è¾‘å™¨
    â†“
can_view = True âœ…
can_edit = True âœ…
    â†“
é€šè¿‡æƒé™æ£€æŸ¥ âœ…
    â†“
æ˜¾ç¤ºç¼–è¾‘å™¨ï¼Œæœ‰"ä¿å­˜"æŒ‰é’® âœ…
```

### æµ‹è¯•2ï¼šview æƒé™
```
ç”¨æˆ·Aåˆ†äº«æ–‡æ¡£ç»™ç”¨æˆ·Cï¼Œæƒé™ï¼šview
    â†“
ç”¨æˆ·Cè®¿é—®ç¼–è¾‘å™¨
    â†“
can_view = True âœ…
can_edit = False âœ…
    â†“
é€šè¿‡æƒé™æ£€æŸ¥ âœ…
    â†“
æ˜¾ç¤ºç¼–è¾‘å™¨ï¼Œæ˜¾ç¤º"åªè¯»æ¨¡å¼" âœ…
```

### æµ‹è¯•3ï¼šæ— æƒé™
```
ç”¨æˆ·Dæœªè¢«åˆ†äº«
    â†“
ç”¨æˆ·Dè®¿é—®ç¼–è¾‘å™¨
    â†“
can_view = False âŒ
can_edit = False âŒ
    â†“
è¢«æ‹¦æˆªï¼Œé‡å®šå‘é¦–é¡µ âœ…
```

## ğŸ“ ä»£ç å¯¹æ¯”

### ä¿®å¤å‰
```python
if share.permission == 'edit':
    can_edit = True
    # âŒ can_view ä»ç„¶æ˜¯ False
else:
    can_view = True
```

### ä¿®å¤å
```python
can_view = True  # âœ… å…ˆè®¾ç½®æŸ¥çœ‹æƒé™
if share.permission == 'edit':
    can_edit = True  # âœ… å†è®¾ç½®ç¼–è¾‘æƒé™
```

## ğŸš€ åº”ç”¨ä¿®å¤

**éœ€è¦é‡å¯ Flask åº”ç”¨ï¼š**
```powershell
# åœæ­¢å½“å‰åº”ç”¨ï¼ˆCtrl+Cï¼‰
# é‡æ–°å¯åŠ¨
python app.py
```

## âœ¨ ä¿®å¤åçš„æ•ˆæœ

1. âœ… å›¾æ ‡æ­£ç¡®æ˜¾ç¤ºï¼ˆedit = ç¼–è¾‘å›¾æ ‡ï¼Œview = æŸ¥çœ‹å›¾æ ‡ï¼‰
2. âœ… ç‚¹å‡»ç¼–è¾‘å›¾æ ‡èƒ½è¿›å…¥ç¼–è¾‘å™¨
3. âœ… edit æƒé™å¯ä»¥ç¼–è¾‘å’Œä¿å­˜
4. âœ… view æƒé™æ˜¾ç¤ºåªè¯»æ¨¡å¼
5. âœ… æ— æƒé™è¢«æ­£ç¡®æ‹¦æˆª

---

**ç°åœ¨æƒé™ç³»ç»Ÿå®Œå…¨æ­£å¸¸äº†ï¼** ğŸ‰
